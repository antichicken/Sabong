using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Text;
using System.Threading.Tasks;
using LukeSkywalker.IPNetwork;

namespace Sabong.Business
{
    public class IpHelper
    {
         int NetMask2Cidr(string netmask)
         {
             int bits = 0;

             var netmaskSplit = netmask.Split('.');

             foreach (var octect in netmaskSplit)
             {
                 bits += octect.Replace("0", "").Length;
             }
             return bits;
         }
         long IP2Long(IPAddress addr)
         {
             try
             {
                 String[] ipbytes;
                 double num = 0;

                 ipbytes = addr.ToString().Split('.');
                 for (int i = ipbytes.Length - 1; i >= 0; i--)
                     num += ((int.Parse(ipbytes[i]) % 256) * Math.Pow(256, (3 - i)));

                 return (long)num;
             }
             catch
             {
                 return -1;
             }
         }

        private static List<string> Vn_Ip_Range = new List<string>()
                                               {"1.52.0.0/255.252.0.0","14.0.16.0/255.255.240.0","14.160.0.0/255.224.0.0","14.224.0.0/255.224.0.0","23.248.170.32/255.255.255.248","27.0.12.0/255.255.252.0","27.2.0.0/255.254.0.0","27.64.0.0/255.240.0.0","27.118.16.0/255.255.240.0","32.42.149.101/255.255.255.255","32.42.149.102/255.255.255.255","42.1.64.0/255.255.192.0","42.96.0.0/255.255.192.0","42.112.0.0/255.248.0.0","49.156.52.0/255.255.252.0","49.213.64.0/255.255.192.0","49.236.208.0/255.255.252.0","49.246.128.0/255.255.192.0","49.246.192.0/255.255.224.0","57.93.80.0/255.255.240.0","58.186.0.0/255.254.0.0","61.11.224.0/255.255.224.0","61.28.224.0/255.255.224.0","63.100.216.176/255.255.255.240","74.112.202.0/255.255.255.248","85.91.117.0/255.255.255.0","101.53.0.0/255.255.192.0","101.96.12.0/255.255.252.0","101.96.64.0/255.255.192.0","101.99.0.0/255.255.192.0","103.1.200.0/255.255.252.0","103.1.208.0/255.255.252.0","103.1.236.0/255.255.252.0","103.2.220.0/255.255.252.0","103.2.224.0/255.255.248.0","103.3.244.0/255.255.252.0","103.3.248.0/255.255.248.0","103.4.128.0/255.255.252.0","103.5.30.0/255.255.254.0","103.5.204.0/255.255.252.0","103.5.208.0/255.255.252.0","103.7.36.0/255.255.252.0","103.7.40.0/255.255.252.0","103.7.172.0/255.255.255.0","103.7.174.0/255.255.254.0","103.7.177.0/255.255.255.0","103.7.196.0/255.255.255.0","103.8.13.0/255.255.255.0","103.9.0.0/255.255.248.0","103.9.76.0/255.255.252.0","103.9.80.0/255.255.248.0","103.9.196.0/255.255.252.0","103.9.200.0/255.255.248.0","103.9.208.0/255.255.248.0","103.10.88.0/255.255.252.0","103.10.212.0/255.255.252.0","103.11.172.0/255.255.252.0","103.12.104.0/255.255.252.0","103.13.76.0/255.255.252.0","103.15.48.0/255.255.252.0","103.16.0.0/255.255.252.0","103.17.88.0/255.255.252.0","103.17.236.0/255.255.252.0","103.18.4.0/255.255.252.0","103.18.176.0/255.255.252.0","103.19.96.0/255.255.252.0","103.19.164.0/255.255.252.0","103.19.220.0/255.255.252.0","103.20.144.0/255.255.248.0","103.21.120.0/255.255.252.0","103.21.148.0/255.255.252.0","103.23.144.0/255.255.252.0","103.23.156.0/255.255.252.0","103.24.244.0/255.255.252.0","103.26.252.0/255.255.252.0","103.27.60.0/255.255.252.0","103.27.64.0/255.255.252.0","103.27.229.128/255.255.255.128","103.27.231.0/255.255.255.128","103.27.236.0/255.255.252.0","103.28.32.0/255.255.248.0","103.28.136.0/255.255.252.0","103.28.172.0/255.255.252.0","103.30.36.0/255.255.252.0","103.31.120.0/255.255.248.0","103.37.28.0/255.255.252.0","103.37.32.0/255.255.252.0","103.38.136.0/255.255.252.0","103.39.92.0/255.255.252.0","103.39.96.0/255.255.252.0","103.42.56.0/255.255.252.0","103.45.228.0/255.255.252.0","103.45.232.0/255.255.248.0","103.224.168.0/255.255.252.0","103.225.236.0/255.255.252.0","103.226.108.0/255.255.252.0","103.226.248.0/255.255.252.0","103.227.112.0/255.255.252.0","103.227.216.0/255.255.252.0","103.228.20.0/255.255.252.0","103.229.40.0/255.255.252.0","103.229.192.0/255.255.252.0","103.231.148.0/255.255.252.0","103.232.52.0/255.255.252.0","103.232.56.0/255.255.248.0","103.232.120.0/255.255.252.0","103.233.48.0/255.255.252.0","103.234.36.0/255.255.252.0","103.234.88.0/255.255.252.0","103.235.208.0/255.255.248.0","103.237.60.0/255.255.252.0","103.237.64.0/255.255.252.0","103.237.96.0/255.255.252.0","103.237.144.0/255.255.248.0","103.238.68.0/255.255.252.0","103.238.72.0/255.255.248.0","103.238.80.0/255.255.252.0","103.238.208.0/255.255.248.0","103.239.32.0/255.255.252.0","103.239.116.0/255.255.252.0","103.239.120.0/255.255.252.0","103.241.248.0/255.255.252.0","103.242.52.0/255.255.252.0","103.243.104.0/255.255.252.0","103.243.216.0/255.255.252.0","103.244.136.0/255.255.252.0","103.245.148.0/255.255.252.0","103.245.244.0/255.255.252.0","103.245.248.0/255.255.248.0","103.246.104.0/255.255.255.0","103.246.220.0/255.255.252.0","103.248.160.0/255.255.248.0","103.249.20.0/255.255.252.0","103.249.100.0/255.255.252.0","103.250.24.0/255.255.252.0","103.252.0.0/255.255.252.0","103.252.252.0/255.255.252.0","103.253.88.0/255.255.252.0","103.254.12.0/255.255.252.0","103.254.16.0/255.255.252.0","103.254.40.0/255.255.252.0","103.254.216.0/255.255.252.0","103.255.84.0/255.255.252.0","103.255.236.0/255.255.252.0","104.143.93.0/255.255.255.0","104.143.95.0/255.255.255.0","104.218.160.248/255.255.255.248","110.35.64.0/255.255.240.0","110.44.184.0/255.255.248.0","111.65.240.0/255.255.240.0","111.91.232.0/255.255.252.0","112.72.64.0/255.255.192.0","112.78.0.0/255.255.240.0","112.109.88.0/255.255.248.0","112.137.128.0/255.255.240.0","112.197.0.0/255.255.0.0","112.213.80.0/255.255.240.0","113.20.96.0/255.255.224.0","113.22.0.0/255.255.0.0","113.23.0.0/255.255.128.0","113.52.32.0/255.255.224.0","113.61.108.0/255.255.252.0","113.160.0.0/255.224.0.0","115.72.0.0/255.248.0.0","115.84.176.0/255.255.248.0","115.146.120.0/255.255.248.0","115.165.160.0/255.255.248.0","116.68.128.0/255.255.248.0","116.96.0.0/255.240.0.0","116.118.0.0/255.255.128.0","116.193.64.0/255.255.240.0","116.212.32.0/255.255.224.0","117.0.0.0/255.248.0.0","117.103.192.0/255.255.192.0","117.122.0.0/255.255.128.0","118.68.0.0/255.252.0.0","118.99.13.0/255.255.255.0","118.102.0.0/255.255.248.0","118.107.64.0/255.255.192.0","119.15.160.0/255.255.224.0","119.17.192.0/255.255.192.0","119.18.128.0/255.255.240.0","119.18.184.0/255.255.248.0","119.81.126.112/255.255.255.240","119.81.245.184/255.255.255.248","119.81.246.248/255.255.255.248","119.82.128.0/255.255.240.0","120.50.184.0/255.255.248.0","120.72.80.0/255.255.248.0","120.72.96.0/255.255.224.0","120.138.64.0/255.255.240.0","122.102.112.0/255.255.252.0","122.129.0.0/255.255.192.0","122.152.155.1/255.255.255.255","122.152.155.2/255.255.255.255","122.152.155.19/255.255.255.255","122.152.155.33/255.255.255.255","122.152.155.37/255.255.255.255","122.152.155.41/255.255.255.255","122.152.155.45/255.255.255.255","122.152.155.53/255.255.255.255","122.152.155.57/255.255.255.255","122.152.155.133/255.255.255.255","122.152.155.134/255.255.255.255","122.152.155.137/255.255.255.255","122.152.155.138/255.255.255.255","122.152.155.141/255.255.255.255","122.152.155.142/255.255.255.255","122.152.155.145/255.255.255.255","122.152.155.146/255.255.255.255","122.152.155.149/255.255.255.255","122.152.155.150/255.255.255.255","122.152.155.157/255.255.255.255","122.152.155.158/255.255.255.255","122.152.155.165/255.255.255.255","122.152.155.166/255.255.255.255","122.152.155.169/255.255.255.255","122.152.155.170/255.255.255.255","122.152.155.226/255.255.255.254","122.152.155.228/255.255.255.254","122.152.155.230/255.255.255.255","122.201.8.0/255.255.248.0","123.16.0.0/255.248.0.0","123.24.0.0/255.252.0.0","123.28.0.0/255.254.0.0","123.30.0.0/255.255.254.0","123.30.2.0/255.255.255.0","123.30.3.0/255.255.255.224","123.30.3.32/255.255.255.248","123.30.3.48/255.255.255.240","123.30.3.64/255.255.255.192","123.30.3.128/255.255.255.128","123.30.4.0/255.255.255.0","123.30.5.0/255.255.255.224","123.30.5.32/255.255.255.248","123.30.5.40/255.255.255.252","123.30.5.48/255.255.255.240","123.30.5.64/255.255.255.192","123.30.5.128/255.255.255.128","123.30.6.0/255.255.254.0","123.30.8.0/255.255.248.0","123.30.16.0/255.255.240.0","123.30.32.0/255.255.224.0","123.30.64.0/255.255.192.0","123.30.128.0/255.255.128.0","123.31.0.0/255.255.0.0","124.157.0.0/255.255.192.0","124.158.0.0/255.255.240.0","125.58.0.0/255.255.192.0","125.212.128.0/255.255.128.0","125.214.0.0/255.255.224.0","125.214.32.0/255.255.248.0","125.214.40.0/255.255.254.0","125.214.42.0/255.255.255.0","125.214.43.0/255.255.255.224","125.214.43.32/255.255.255.248","125.214.43.48/255.255.255.240","125.214.43.64/255.255.255.224","125.214.43.96/255.255.255.248","125.214.43.112/255.255.255.240","125.214.43.128/255.255.255.128","125.214.44.0/255.255.252.0","125.214.48.0/255.255.240.0","125.234.0.0/255.254.0.0","125.253.112.0/255.255.240.0","134.159.138.0/255.255.255.0","167.88.2.176/255.255.255.248","171.224.0.0/255.224.0.0","174.136.105.192/255.255.255.248","175.103.64.0/255.255.192.0","175.106.0.0/255.255.252.0","179.60.179.192/255.255.255.248","180.93.0.0/255.255.0.0","180.148.0.0/255.255.248.0","180.148.128.0/255.255.240.0","180.214.236.0/255.255.252.0","182.161.80.0/255.255.240.0","182.173.70.0/255.255.255.0","182.236.112.0/255.255.252.0","182.237.20.0/255.255.252.0","183.80.0.0/255.255.0.0","183.81.0.0/255.255.128.0","183.90.160.0/255.255.248.0","183.91.0.0/255.255.224.0","183.91.160.0/255.255.224.0","186.65.121.112/255.255.255.240","186.65.122.128/255.255.255.224","192.34.53.124/255.255.255.255","192.34.53.144/255.255.255.255","192.34.53.166/255.255.255.255","192.34.53.213/255.255.255.255","192.34.55.139/255.255.255.255","192.249.116.8/255.255.255.248","192.253.249.128/255.255.255.128","194.99.212.0/255.255.252.0","202.0.79.0/255.255.255.0","202.4.168.0/255.255.255.0","202.4.176.0/255.255.255.0","202.6.2.0/255.255.255.0","202.6.96.0/255.255.254.0","202.9.79.0/255.255.255.0","202.9.80.0/255.255.255.0","202.9.84.0/255.255.255.0","202.37.86.0/255.255.254.0","202.43.108.0/255.255.252.0","202.44.137.0/255.255.255.0","202.47.87.0/255.255.255.0","202.47.142.0/255.255.255.0","202.52.39.0/255.255.255.0","202.55.132.0/255.255.252.0","202.56.57.0/255.255.255.0","202.58.245.0/255.255.255.0","202.59.238.0/255.255.254.0","202.59.252.0/255.255.254.0","202.60.104.0/255.255.248.0","202.74.56.0/255.255.255.0","202.74.58.0/255.255.254.0","202.78.224.0/255.255.248.0","202.79.232.0/255.255.248.0","202.87.212.0/255.255.252.0","202.92.4.0/255.255.252.0","202.93.156.0/255.255.252.0","202.94.82.0/255.255.255.0","202.94.88.0/255.255.254.0","202.124.204.0/255.255.255.0","202.130.36.0/255.255.254.0","202.134.16.0/255.255.248.0","202.134.54.0/255.255.255.0","202.151.160.0/255.255.240.0","202.158.244.0/255.255.252.0","202.160.124.0/255.255.254.0","202.172.4.0/255.255.254.0","202.174.156.128/255.255.255.192","202.191.56.0/255.255.252.0","203.8.127.0/255.255.255.0","203.8.172.0/255.255.255.0","203.34.144.0/255.255.255.0","203.77.178.0/255.255.255.0","203.79.28.0/255.255.255.0","203.89.140.0/255.255.252.0","203.99.248.0/255.255.252.0","203.113.128.0/255.255.192.0","203.119.8.0/255.255.252.0","203.119.36.0/255.255.252.0","203.119.44.0/255.255.252.0","203.119.58.0/255.255.254.0","203.119.60.0/255.255.252.0","203.119.64.0/255.255.248.0","203.119.72.0/255.255.252.0","203.128.240.0/255.255.248.0","203.160.1.0/255.255.255.0","203.160.96.0/255.255.248.0","203.161.178.0/255.255.255.0","203.162.0.0/255.255.224.0","203.162.32.0/255.255.255.192","203.162.32.80/255.255.255.240","203.162.32.96/255.255.255.224","203.162.32.128/255.255.255.128","203.162.33.0/255.255.255.0","203.162.34.0/255.255.254.0","203.162.36.0/255.255.252.0","203.162.40.0/255.255.248.0","203.162.48.0/255.255.240.0","203.162.64.0/255.255.192.0","203.162.128.0/255.255.128.0","203.163.128.0/255.255.192.0","203.170.26.0/255.255.254.0","203.171.16.0/255.255.240.0","203.176.160.0/255.255.248.0","203.189.28.0/255.255.252.0","203.190.160.0/255.255.255.128","203.190.160.128/255.255.255.224","203.190.160.160/255.255.255.240","203.190.160.184/255.255.255.248","203.190.160.192/255.255.255.192","203.190.161.0/255.255.255.0","203.190.162.0/255.255.254.0","203.190.164.0/255.255.252.0","203.190.168.0/255.255.248.0","203.191.8.0/255.255.248.0","203.191.48.0/255.255.248.0","203.195.0.0/255.255.192.0","203.201.56.0/255.255.252.0","203.205.0.0/255.255.192.0","203.209.180.0/255.255.252.0","203.210.128.0/255.255.128.0","206.125.168.160/255.255.255.240","207.226.152.0/255.255.255.192","210.2.64.0/255.255.192.0","210.86.224.0/255.255.240.0","210.211.96.0/255.255.224.0","210.245.0.0/255.255.128.0","218.100.10.0/255.255.255.0","218.100.14.0/255.255.255.0","218.100.60.0/255.255.255.0","220.231.64.0/255.255.192.0","221.121.0.0/255.255.192.0","221.132.0.0/255.255.192.0","221.133.0.0/255.255.224.0","222.252.0.0/255.254.0.0","222.254.0.0/255.255.0.0","222.255.0.0/255.255.192.0","222.255.64.0/255.255.252.0","222.255.69.0/255.255.255.0","222.255.70.0/255.255.254.0","222.255.72.0/255.255.248.0","222.255.80.0/255.255.254.0","222.255.82.0/255.255.255.0","222.255.83.0/255.255.255.128","222.255.83.128/255.255.255.224","222.255.83.160/255.255.255.240","222.255.83.184/255.255.255.248","222.255.83.192/255.255.255.192","222.255.84.0/255.255.254.0","222.255.86.8/255.255.255.248","222.255.86.16/255.255.255.240","222.255.86.32/255.255.255.224","222.255.86.64/255.255.255.192","222.255.86.128/255.255.255.128","222.255.87.0/255.255.255.0","222.255.88.0/255.255.248.0","222.255.96.0/255.255.224.0","222.255.128.0/255.255.128.0","223.27.104.0/255.255.248.0"
                                               };
        

        public static bool IpIsWithinVNRange(string ip)
        {
            IPAddress incomingIp = IPAddress.Parse(ip);
            foreach (var subnet in Vn_Ip_Range)
            {
                IPNetwork network = IPNetwork.Parse(subnet);

                if (IPNetwork.Contains(network, incomingIp))
                    return true;
            }
            return false;
        }
    }
}
